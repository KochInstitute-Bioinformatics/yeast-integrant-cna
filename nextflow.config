/*
 * Default configuration for yeast-integrant-cna pipeline
 */

// Parameters
params {
    // Input/Output
    samples = null
    outdir = "results"
    
    // Reference files
    reference_genome = null
    transgene_dir = null
    
    // Filtering parameters
    min_quality = 10
    max_length = 5000
    
    // Help
    help = false
}

// Process configuration
process {
    // Default resources
    cpus = 2
    memory = '4 GB'
    time = '2h'
    
    // Error handling
    errorStrategy = 'retry'
    maxRetries = 2
    
    // Process-specific settings
    withName: 'CHOPPER' {
        container = 'bumproo/nanoplotchopper'
        cpus = 4
        memory = '8 GB'
    }
    
    withName: 'NANOPLOT' {
        container = 'bumproo/nanoplotchopper'
        cpus = 2
        memory = '4 GB'
    }
    
    withName: 'COMBINE_REFERENCE' {
        cpus = 1
        memory = '2 GB'
    }
    
    withName: 'MINIMAP2_ALIGN' {
        container = 'quay.io/biocontainers/minimap2:2.26--he4a0461_2'
        cpus = 8
        memory = '16 GB'
        time = '4h'
    }
    
    withName: 'SAMTOOLS_SORT' {
        container = 'quay.io/biocontainers/samtools:1.18--h50ea8bc_1'
        cpus = 4
        memory = '8 GB'
    }
    
    withName: 'SAMTOOLS_INDEX' {
        container = 'quay.io/biocontainers/samtools:1.18--h50ea8bc_1'
        cpus = 2
        memory = '4 GB'
    }
}

// Execution profiles
profiles {
    standard {
        process.executor = 'local'
    }
    
    conda {
        conda.enabled = true
        conda.useMamba = true
        
        process {
            withName: 'CHOPPER' {
                conda = 'bioconda::chopper bioconda::nanoplot'
            }
            withName: 'NANOPLOT' {
                conda = 'bioconda::nanoplot'
            }
            withName: 'MINIMAP2_ALIGN' {
                conda = 'bioconda::minimap2 bioconda::samtools'
            }
            withName: 'SAMTOOLS_.*' {
                conda = 'bioconda::samtools'
            }
        }
    }
    
    singularity {
        singularity.enabled = true
        singularity.autoMounts = true
    }
    
    docker {
        docker.enabled = true
        docker.runOptions = '-u $(id -u):$(id -g)'
    }
}

// Execution reports
timeline {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_timeline.html"
    overwrite = true
}

report {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_report.html"
    overwrite = true
}

trace {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_trace.txt"
    overwrite = true
}

dag {
    enabled = true
    file = "${params.outdir}/pipeline_info/pipeline_dag.svg"
    overwrite = true
}

// Capture exit codes from upstream processes when piping
process.shell = ['/bin/bash', '-euo', 'pipefail']

// Manifest
manifest {
    name = 'yeast-integrant-cna'
    author = 'Seqera AI'
    description = 'Oxford Nanopore workflow for yeast chromosome and plasmid copy number analysis'
    mainScript = 'main.nf'
    nextflowVersion = '>=23.04.0'
    version = '1.0.0'
}
